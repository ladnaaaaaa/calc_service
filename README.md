# Calc Service

Calc Service - это веб-сервис для распределённых вычислений, который позволяет выполнять арифметические выражения в распределённом режиме. Сервис использует архитектуру, состоящую из оркестратора и агентов, для эффективного выполнения задач.

## Ссылка на сайт

Сервис доступен по адресу: [http://localhost:8080](http://localhost:8080)

## Инструкция по запуску

1. **Убедитесь, что установлен Go** (версии 1.20 или выше).

2. **Установите GCC**:
   - Для Windows: Скачайте и установите MinGW-w64 с официального сайта по [инструкции](https://programforyou.ru/poleznoe/kak-ustanovit-gcc-dlya-windows?ysclid=majlp37z7w118007909).
3. **Настройте переменную окружения CGO**:
   - Установите переменную окружения `CGO_ENABLED=1` для включения поддержки CGO:
     ```bash
     set CGO_ENABLED=1
     ```

4. **Склонируйте репозиторий**:
   ```bash
   git clone https://github.com/ladnaaaaaa/calc_service.git
   cd calc_service
   ```

5. **Запустите оркестратор**:
   ```bash
   go run ./cmd/orchestrator/...
   ```

6. **Запустите агент (в отдельном окне терминала)**:
   ```bash
   go run ./cmd/agent/...
   ```

7. **Откройте веб-интерфейс**:
   - Перейдите по адресу [http://localhost:8080](http://localhost:8080) в браузере.
   - Пройдите авторизацию.
   - Введите арифметическое выражение и нажмите "Вычислить".

8. **Запуск тестов**:
   - Запустите тесты из интерфейса IDE или из командной строки:
     ```bash
     go test ./internal/orchestrator/... -v
     ```

## Эндпоинты API

Сервис предоставляет следующие эндпоинты:
- `POST /api/v1/register` - регистрация нового пользователя.
- `POST /api/v1/login` - авторизация пользователя.
- `POST /api/v1/calculate` - отправка выражения на вычисление.
- `GET /api/v1/expressions` - получение списка выражений.
- `GET /api/v1/expressions/:id` - получение выражения по ID.
- `GET /internal/task` - получение задачи для вычисления.
- `POST /internal/task` - отправка результата задачи.

## Переменные окружения

Для настройки времени выполнения операций можно задать следующие переменные окружения:
- `TIME_ADDITION_MS` - время выполнения сложения (мс).
- `TIME_MULTIPLICATIONS_MS` - время выполнения умножения (мс).
- `TIME_SUBTRACTION_MS` - время выполнения вычитания (мс).
- `TIME_DIVISIONS_MS` - время выполнения деления (мс).

Пример настройки (Windows):
```bash
set TIME_ADDITION_MS=1000
set TIME_MULTIPLICATIONS_MS=2000
set TIME_SUBTRACTION_MS=1000
set TIME_DIVISIONS_MS=3000
```

## Последние изменения

- Исправлены тесты в `storage_test.go` и `parser_test.go`.
- Обновлена логика обновления результата выражения в `handleSubmitTask`.
- Добавлен метод `UpdateExpression` в `Store` для корректного обновления результата выражения.
- Улучшена обработка ошибок и логирование в сервисе.
- Оптимизирована работа с базой данных для повышения производительности.